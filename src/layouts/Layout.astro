---
import "../styles/global.css";
import SEO from "../components/SEO.astro";
import Logo from "../components/Logo.astro";
import CookieConsent from "../components/CookieConsent.astro";

interface Props {
	title: string;
	description?: string;
	keywords?: string;
	image?: string;
	type?: "website" | "article";
}

const {
	title,
	description = "Sal칩n de belleza de alta gama en Plaza Santo Domingo, Murcia. Manicura, pedicura, pesta침as y m치s.",
	keywords,
	image,
	type,
} = Astro.props;

import { supabase } from "../lib/supabase";

// Fetch services for the dynamic menu
const { data: services } = await supabase
	.from("services")
	.select("slug, hero_title, category")
	.order("display_order", { ascending: true });

// Group services by category
const servicesByCategory = (services || []).reduce((acc: any, service) => {
	if (!acc[service.category]) acc[service.category] = [];
	acc[service.category].push(service);
	return acc;
}, {});

// Category display names mapping
const categoryNames: Record<string, string> = {
	manicura: "Manicura",
	pedicura: "Pedicura",
	cejas: "Cejas",
	pestanas: "Pesta침as",
	peluqueria: "Peluquer칤a",
};

// Defined category order
const categoryOrder = [
	"manicura",
	"pedicura",
	"cejas",
	"pestanas",
	"peluqueria",
];
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />

		<SEO
			title={title}
			description={description}
			keywords={keywords}
			image={image}
			type={type}
		/>
	</head>
	<body class="antialiased bg-cream-100 text-brown-600">
		<!-- Navigation Header -->
		<nav
			class="fixed top-0 w-full z-50 bg-cream-50/95 backdrop-blur-sm border-b border-gold-200/20"
			id="navbar"
		>
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="flex justify-between items-center h-20">
					<!-- Menu Button (Left) -->
					<button id="menu-toggle" class="group relative px-2 py-1">
						<span
							class="font-serif text-xl sm:text-2xl text-brown-800 group-hover:text-gold-600 transition-colors duration-300"
							>Men칰</span
						>
						<span
							class="absolute bottom-0 left-0 w-0 h-0.5 bg-brown-800 transition-all duration-500 ease-out group-hover:w-full"
						></span>
					</button>

					<!-- Logo (Center) -->
					<div
						class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2"
					>
						<a href="/" class="block w-44 sm:w-52">
							<Logo class="w-full h-auto text-brown-800 p-1" />
						</a>
					</div>

					<!-- Contact Button (Right) -->
					<a href="/contacto" class="group relative px-2 py-1">
						<span
							class="font-serif text-xl sm:text-2xl text-brown-800 group-hover:text-gold-600 transition-colors duration-300"
							>Contacto</span
						>
						<span
							class="absolute bottom-0 left-0 w-0 h-0.5 bg-brown-800 transition-all duration-500 ease-out group-hover:w-full"
						></span>
					</a>
				</div>
			</div>
		</nav>

		<!-- Full Screen Menu Overlay (Dark - Almost Black) -->
		<div
			id="menu-overlay"
			class="fixed inset-0 bg-[#1a1a1a] z-[100] opacity-0 pointer-events-none overflow-hidden"
		>
			<!-- Close Button (Top Right) -->
			<button
				id="menu-close"
				class="absolute top-6 right-6 sm:top-8 sm:right-8 w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-full bg-cream-50/10 hover:bg-gold-500 transition-all duration-300 group z-10 opacity-0"
			>
				<svg
					class="w-5 h-5 sm:w-6 sm:h-6 text-cream-50 group-hover:text-brown-900 transition-colors"
					fill="none"
					stroke="currentColor"
					viewBox="0 0 24 24"
				>
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="2"
						d="M6 18L18 6M6 6l12 12"></path>
				</svg>
			</button>

			<div class="h-screen overflow-y-auto">
				<div class="min-h-screen flex flex-col">
					<!-- Main Content -->
					<div
						class="flex-1 flex items-start sm:items-center py-20 sm:py-0"
					>
						<div class="w-full max-w-7xl mx-auto px-6 sm:px-8">
							<div
								class="grid grid-cols-1 lg:grid-cols-12 gap-10 sm:gap-12 lg:gap-20"
							>
								<!-- Main Menu (Left Side) -->
								<div class="lg:col-span-4">
									<nav class="space-y-4 sm:space-y-6">
										<a
											href="/"
											class="menu-main-item opacity-0 block text-4xl sm:text-5xl lg:text-6xl font-serif font-light text-cream-50 hover:text-gold-400 transition-colors duration-300"
										>
											Inicio
										</a>
										<a
											href="/nosotras"
											class="menu-main-item opacity-0 block text-4xl sm:text-5xl lg:text-6xl font-serif font-light text-cream-50 hover:text-gold-400 transition-colors duration-300"
										>
											Nosotras
										</a>
										<a
											href="/servicios"
											class="menu-main-item opacity-0 block text-4xl sm:text-5xl lg:text-6xl font-serif font-light text-cream-50 hover:text-gold-400 transition-colors duration-300"
										>
											Servicios
										</a>
										<a
											href="/blog"
											class="menu-main-item opacity-0 block text-4xl sm:text-5xl lg:text-6xl font-serif font-light text-cream-50 hover:text-gold-400 transition-colors duration-300"
										>
											Blog
										</a>
										<a
											href="/contacto"
											class="menu-main-item opacity-0 block text-4xl sm:text-5xl lg:text-6xl font-serif font-light text-cream-50 hover:text-gold-400 transition-colors duration-300"
										>
											Contacto
										</a>
									</nav>
								</div>

								<!-- Services Grid (Right Side) - Improved for Mobile -->
								<div class="lg:col-span-8">
									<div
										class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 sm:gap-x-12 gap-y-8 sm:gap-y-8 pb-10 sm:pb-0"
									>
										{
											categoryOrder.map((catKey) => (
												<div class="menu-service-category opacity-0 border-t border-cream-50/20 pt-4 sm:pt-6">
													<h3 class="text-2xl sm:text-2xl font-serif font-medium text-gold-400 mb-3 sm:mb-4">
														{categoryNames[catKey]}
													</h3>
													<ul class="space-y-2 sm:space-y-2">
														{servicesByCategory[
															catKey
														]?.map(
															(service: any) => (
																<li>
																	<a
																		href={`/${catKey}/${service.slug}`}
																		class="text-cream-50 hover:text-gold-400 transition-colors text-base sm:text-base font-light"
																	>
																		{
																			service.hero_title
																		}
																	</a>
																</li>
															),
														) || (
															<li class="text-cream-50/50 text-sm italic">
																Pr칩ximamente
															</li>
														)}
													</ul>
												</div>
											))
										}
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Footer with Social Icons -->
					<div class="border-t border-cream-50/10 mt-auto">
						<div
							class="max-w-7xl mx-auto px-6 sm:px-8 py-5 sm:py-6"
						>
							<div
								class="flex items-center justify-center gap-6 sm:gap-8"
							>
								<a
									href="https://instagram.com"
									target="_blank"
									rel="noopener"
									class="menu-social-icon opacity-0 w-11 h-11 sm:w-12 sm:h-12 rounded-full bg-cream-50/10 hover:bg-gold-500 flex items-center justify-center transition-all duration-300 group"
								>
									<svg
										class="w-5 h-5 text-cream-50 group-hover:text-brown-900 transition-colors"
										fill="currentColor"
										viewBox="0 0 24 24"
									>
										<path
											d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"
										></path>
									</svg>
								</a>
								<a
									href="https://facebook.com"
									target="_blank"
									rel="noopener"
									class="menu-social-icon opacity-0 w-11 h-11 sm:w-12 sm:h-12 rounded-full bg-cream-50/10 hover:bg-gold-500 flex items-center justify-center transition-all duration-300 group"
								>
									<svg
										class="w-5 h-5 text-cream-50 group-hover:text-brown-900 transition-colors"
										fill="currentColor"
										viewBox="0 0 24 24"
									>
										<path
											d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
										></path>
									</svg>
								</a>
								<a
									href="https://tiktok.com"
									target="_blank"
									rel="noopener"
									class="menu-social-icon opacity-0 w-11 h-11 sm:w-12 sm:h-12 rounded-full bg-cream-50/10 hover:bg-gold-500 flex items-center justify-center transition-all duration-300 group"
								>
									<svg
										class="w-5 h-5 text-cream-50 group-hover:text-brown-900 transition-colors"
										fill="currentColor"
										viewBox="0 0 24 24"
									>
										<path
											d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"
										></path>
									</svg>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<main class="pt-20">
			<slot />
		</main>

		<!-- Footer -->
		<footer class="bg-[#1a1a1a] text-cream-100 py-16">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="grid grid-cols-1 md:grid-cols-4 gap-8">
					<div>
						<div class="w-40 mb-4">
							<Logo class="w-full h-auto text-cream-50" />
						</div>
						<p class="text-sm text-cream-200">
							Sal칩n de belleza de alta gama en el coraz칩n de
							Murcia
						</p>
					</div>

					<div>
						<h4 class="font-medium mb-4 text-base sm:text-lg">
							Servicios
						</h4>
						<ul
							class="space-y-2 text-sm sm:text-base text-cream-200"
						>
							<li>
								<a
									href="/manicura"
									class="hover:text-gold-400 transition-colors"
									>Manicura</a
								>
							</li>
							<li>
								<a
									href="/pedicura"
									class="hover:text-gold-400 transition-colors"
									>Pedicura</a
								>
							</li>
							<li>
								<a
									href="/cejas"
									class="hover:text-gold-400 transition-colors"
									>Cejas</a
								>
							</li>
							<li>
								<a
									href="/pestanas"
									class="hover:text-gold-400 transition-colors"
									>Pesta침as</a
								>
							</li>
							<li>
								<a
									href="/peluqueria"
									class="hover:text-gold-400 transition-colors"
									>Peluquer칤a</a
								>
							</li>
						</ul>
					</div>

					<div>
						<h4 class="font-medium mb-4 text-base sm:text-lg">
							Informaci칩n
						</h4>
						<ul
							class="space-y-2 text-sm sm:text-base text-cream-200"
						>
							<li>
								<a
									href="/nosotras"
									class="hover:text-gold-400 transition-colors"
									>Nosotras</a
								>
							</li>
							<li>
								<a
									href="/contacto"
									class="hover:text-gold-400 transition-colors"
									>Contacto</a
								>
							</li>
							<li>
								<a
									href="/blog"
									class="hover:text-gold-400 transition-colors"
									>Blog</a
								>
							</li>
							<li>
								<a
									href="/privacidad"
									class="hover:text-gold-400 transition-colors"
									>Privacidad</a
								>
							</li>
							<li>
								<a
									href="/cookies"
									class="hover:text-gold-400 transition-colors"
									>Cookies</a
								>
							</li>
						</ul>
					</div>

					<div>
						<h4 class="font-medium mb-4 text-base sm:text-lg">
							Contacto
						</h4>
						<p class="text-sm sm:text-base text-cream-200 mb-2">
							Plaza Santo Domingo
						</p>
						<p class="text-sm sm:text-base text-cream-200 mb-2">
							Murcia, Espa침a
						</p>
						<p class="text-sm sm:text-base text-cream-200">
							+34 613 30 29 14
						</p>
					</div>
				</div>

				<div
					class="border-t border-cream-50/10 mt-8 pt-8 text-center text-sm text-cream-300"
				>
					<p class="mb-2">
						&copy; {new Date().getFullYear()} Angeles Nails Studio. Todos
						los derechos reservados.
					</p>
					<p class="text-xs text-cream-400">
						Made with <span
							id="rotating-emoji"
							class="inline-block transition-all duration-300"
							>游눹</span
						> by <a
							href="https://www.tictag.es"
							target="_blank"
							rel="noopener noreferrer"
							class="text-gold-400 hover:text-gold-300 transition-colors font-medium"
							>Tictag</a
						>
					</p>
				</div>

				<script>
					// Rotating emoji animation
					const emojis = ["游눹", "游빚", "仇벒잺", "游댌", "游댏", "游댩", "游눠"];
					let currentEmojiIndex = 0;
					const emojiElement =
						document.getElementById("rotating-emoji");

					if (emojiElement) {
						setInterval(() => {
							currentEmojiIndex =
								(currentEmojiIndex + 1) % emojis.length;
							emojiElement.textContent =
								emojis[currentEmojiIndex];
						}, 1000);
					}
				</script>
			</div>
		</footer>

		<!-- Menu Toggle Script with GSAP Animations -->
		<script>
			import { gsap } from "gsap";

			const menuToggle = document.getElementById("menu-toggle");
			const menuClose = document.getElementById("menu-close");
			const menuOverlay = document.getElementById("menu-overlay");

			function openMenu() {
				if (menuOverlay) {
					menuOverlay.classList.remove("pointer-events-none");
					menuOverlay.classList.add("pointer-events-auto");
					document.body.style.overflow = "hidden";

					// Menu slides down from top
					gsap.fromTo(
						menuOverlay,
						{
							opacity: 0,
							y: -100,
						},
						{
							opacity: 1,
							y: 0,
							duration: 0.6,
							ease: "power3.out",
						},
					);

					// Animate main menu items
					gsap.fromTo(
						".menu-main-item",
						{
							opacity: 0,
							y: 30,
						},
						{
							opacity: 1,
							y: 0,
							duration: 0.8,
							stagger: 0.1,
							delay: 0.3,
							ease: "power3.out",
						},
					);

					// Animate service categories
					gsap.fromTo(
						".menu-service-category",
						{
							opacity: 0,
							y: 20,
						},
						{
							opacity: 1,
							y: 0,
							duration: 0.6,
							stagger: 0.08,
							delay: 0.5,
							ease: "power2.out",
						},
					);

					// Animate close button
					gsap.fromTo(
						"#menu-close",
						{
							opacity: 0,
							scale: 0.8,
							rotation: -90,
						},
						{
							opacity: 1,
							scale: 1,
							rotation: 0,
							duration: 0.5,
							delay: 0.4,
							ease: "back.out(1.7)",
						},
					);

					// Animate social icons
					gsap.fromTo(
						".menu-social-icon",
						{
							opacity: 0,
							scale: 0,
						},
						{
							opacity: 1,
							scale: 1,
							duration: 0.4,
							stagger: 0.1,
							delay: 0.8,
							ease: "back.out(1.7)",
						},
					);
				}
			}

			function closeMenu() {
				if (menuOverlay) {
					gsap.to(menuOverlay, {
						opacity: 0,
						duration: 0.3,
						ease: "power2.in",
						onComplete: () => {
							menuOverlay.classList.add("pointer-events-none");
							menuOverlay.classList.remove("pointer-events-auto");
							document.body.style.overflow = "";
						},
					});
				}
			}

			menuToggle?.addEventListener("click", openMenu);
			menuClose?.addEventListener("click", closeMenu);

			// Close on escape key
			document.addEventListener("keydown", (e) => {
				if (e.key === "Escape") closeMenu();
			});
		</script>

		<!-- Lenis Smooth Scroll -->
		<script>
			import Lenis from "lenis";

			const lenis = new Lenis({
				duration: 1.2,
				easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
			});

			function raf(time: number) {
				lenis.raf(time);
				requestAnimationFrame(raf);
			}

			requestAnimationFrame(raf);
		</script>

		<!-- Cookie Consent Banner -->
		<CookieConsent />
	</body>
</html>
