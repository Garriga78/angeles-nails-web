---
export const prerender = false;
import Layout from "../layouts/Layout.astro";
import CTAWhatsApp from "../components/CTAWhatsApp.astro";
import Testimonials from "../components/Testimonials.astro";
import { supabase } from "../lib/supabase";

// Force no-cache for Vercel SSR
Astro.response.headers.set(
    "Cache-Control",
    "no-cache, no-store, must-revalidate",
);
Astro.response.headers.set("Pragma", "no-cache");
Astro.response.headers.set("Expires", "0");
Astro.response.headers.set("Surrogate-Control", "no-store"); // Additional Vercel header

// ... rest of the file

// Force no-cache for Vercel SSR
Astro.response.headers.set(
    "Cache-Control",
    "no-cache, no-store, must-revalidate",
);
Astro.response.headers.set("Pragma", "no-cache");
Astro.response.headers.set("Expires", "0");

// Fetch all services
const { data: services, error } = await supabase
    .from("services")
    .select("*")
    .order("display_order", { ascending: true });

if (error) {
    console.error("Error fetching services:", error);
}

// Helper to get a representative image for a category
const getCategoryImage = (category: string) => {
    const service = services?.find(
        (s) => s.category === category && s.hero_image_url,
    );
    return service?.hero_image_url || "/img/placeholder.svg";
};

// Filter services for Quick Menu (example: filtered by some criteria or just take first 6)
// Since the original had specific items, we will try to find them or just list top items.
// For now, let's list the first 6 services as "Featured" in Quick Menu
const quickMenuServices = services?.slice(0, 6) || [];

const manicuraImg = getCategoryImage("manicura");
const pedicuraImg = getCategoryImage("pedicura");
const cejasImg = getCategoryImage("cejas");
const pestanasImg = getCategoryImage("pestanas");
const peluqueriaImg = getCategoryImage("peluqueria");
---

<Layout
    title="Nuestros Servicios | Angeles Nails Studio - Belleza Integral en Murcia"
    description="Descubre nuestra gama completa de servicios: Manicura, Pedicura, Cejas, Pestañas y Peluquería. Tratamientos exclusivos en el centro de Murcia."
>
    <CTAWhatsApp />

    <!-- Hero Section -->
    <section
        class="relative h-[60vh] flex items-center justify-center overflow-hidden pt-32"
    >
        <div class="absolute inset-0 z-0">
            <img
                src="/img/placeholder.svg"
                alt="Servicios Angeles Nails"
                class="w-full h-full object-cover"
                id="hero-image"
            />
            <div class="absolute inset-0 bg-black/50"></div>
        </div>
        <div class="text-center z-10 px-4 max-w-4xl mx-auto">
            <h1
                class="font-serif text-5xl md:text-7xl font-bold mb-6 text-white reveal-text opacity-0"
            >
                Nuestros servicios
            </h1>
            <p
                class="text-xl md:text-2xl font-light text-white mb-8 reveal-text opacity-0"
            >
                Un universo de belleza y bienestar diseñado para ti
            </p>
        </div>
    </section>

    <!-- Main Categories - Zig Zag Layout -->
    <section class="py-24 bg-cream-50 overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-32">
            <!-- Manicura (Image Left) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div class="relative group reveal-element opacity-0">
                    <div
                        class="overflow-hidden rounded-lg shadow-2xl relative h-[600px]"
                    >
                        <img
                            src={manicuraImg}
                            alt="Manicura"
                            class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110 parallax-img"
                        />
                        <div
                            class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-500"
                        >
                        </div>
                    </div>
                    <!-- Decorative Element -->
                    <div
                        class="absolute -bottom-10 -left-10 w-40 h-40 bg-gold-200/30 rounded-full blur-3xl -z-10"
                    >
                    </div>
                </div>
                <div class="space-y-8 reveal-text opacity-0">
                    <h2
                        class="text-4xl md:text-6xl font-serif font-bold text-brown-800"
                    >
                        Manicura
                    </h2>
                    <p class="text-xl text-brown-600 leading-relaxed">
                        Desde la elegancia de lo natural hasta la creatividad
                        del Nail Art. Nuestras técnicas de manicura rusa, soft
                        gel y polygel garantizan resultados impecables y
                        duraderos.
                    </p>
                    <ul class="space-y-4 text-brown-700">
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Manicura rusa (Limpieza profunda)
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Nivelación y refuerzo
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Extensiones soft gel y polygel
                        </li>
                    </ul>
                    <div class="pt-4">
                        <a
                            href="/manicura"
                            class="inline-block bg-brown-800 text-cream-50 px-10 py-4 rounded-full hover:bg-gold-500 hover:text-brown-900 transition-all duration-300 font-medium"
                        >
                            Ver tratamientos de manicura
                        </a>
                    </div>
                </div>
            </div>

            <!-- Pedicura (Image Right) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div class="space-y-8 reveal-text opacity-0 order-2 lg:order-1">
                    <h2
                        class="text-4xl md:text-6xl font-serif font-bold text-brown-800"
                    >
                        Pedicura
                    </h2>
                    <p class="text-xl text-brown-600 leading-relaxed">
                        El cuidado que tus pies merecen. Fusionamos salud y
                        estética en nuestros tratamientos de pedicura,
                        ofreciendo una experiencia de relajación total.
                    </p>
                    <ul class="space-y-4 text-brown-700">
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Pedicura completa
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Esmaltado semipermanente
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Tratamiento de durezas e hidratación
                        </li>
                    </ul>
                    <div class="pt-4">
                        <a
                            href="/pedicura"
                            class="inline-block bg-brown-800 text-cream-50 px-10 py-4 rounded-full hover:bg-gold-500 hover:text-brown-900 transition-all duration-300 font-medium"
                        >
                            Ver tratamientos de pedicura
                        </a>
                    </div>
                </div>
                <div
                    class="relative group reveal-element opacity-0 order-1 lg:order-2"
                >
                    <div
                        class="overflow-hidden rounded-lg shadow-2xl relative h-[600px]"
                    >
                        <img
                            src={pedicuraImg}
                            alt="Pedicura"
                            class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110 parallax-img"
                        />
                        <div
                            class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-500"
                        >
                        </div>
                    </div>
                    <div
                        class="absolute -top-10 -right-10 w-40 h-40 bg-gold-200/30 rounded-full blur-3xl -z-10"
                    >
                    </div>
                </div>
            </div>

            <!-- Cejas (Image Left) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div class="relative group reveal-element opacity-0">
                    <div
                        class="overflow-hidden rounded-lg shadow-2xl relative h-[600px]"
                    >
                        <img
                            src={cejasImg}
                            alt="Cejas"
                            class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110 parallax-img"
                        />
                        <div
                            class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-500"
                        >
                        </div>
                    </div>
                    <div
                        class="absolute -bottom-10 -left-10 w-40 h-40 bg-gold-200/30 rounded-full blur-3xl -z-10"
                    >
                    </div>
                </div>
                <div class="space-y-8 reveal-text opacity-0">
                    <h2
                        class="text-4xl md:text-6xl font-serif font-bold text-brown-800"
                    >
                        Cejas
                    </h2>
                    <p class="text-xl text-brown-600 leading-relaxed">
                        El marco de tu mirada. Diseñamos tus cejas estudiando
                        tus facciones para potenciar tu expresión natural con
                        las técnicas más innovadoras.
                    </p>
                    <ul class="space-y-4 text-brown-700">
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Diseño y visagismo
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Laminado de cejas (Brow Lamination)
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Tinte y henna
                        </li>
                    </ul>
                    <div class="pt-4">
                        <a
                            href="/cejas"
                            class="inline-block bg-brown-800 text-cream-50 px-10 py-4 rounded-full hover:bg-gold-500 hover:text-brown-900 transition-all duration-300 font-medium"
                        >
                            Ver tratamientos de cejas
                        </a>
                    </div>
                </div>
            </div>

            <!-- Pestañas (Image Right) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div class="space-y-8 reveal-text opacity-0 order-2 lg:order-1">
                    <h2
                        class="text-4xl md:text-6xl font-serif font-bold text-brown-800"
                    >
                        Pestañas
                    </h2>
                    <p class="text-xl text-brown-600 leading-relaxed">
                        Despierta con una mirada perfecta cada día. Desde un
                        lifting natural hasta el volumen más glamuroso,
                        personalizamos el diseño para ti.
                    </p>
                    <ul class="space-y-4 text-brown-700">
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Lifting de pestañas
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Extensiones pelo a pelo
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Volumen ruso y megavolumen
                        </li>
                    </ul>
                    <div class="pt-4">
                        <a
                            href="/pestanas"
                            class="inline-block bg-brown-800 text-cream-50 px-10 py-4 rounded-full hover:bg-gold-500 hover:text-brown-900 transition-all duration-300 font-medium"
                        >
                            Ver tratamientos de pestañas
                        </a>
                    </div>
                </div>
                <div
                    class="relative group reveal-element opacity-0 order-1 lg:order-2"
                >
                    <div
                        class="overflow-hidden rounded-lg shadow-2xl relative h-[600px]"
                    >
                        <img
                            src={pestanasImg}
                            alt="Pestañas"
                            class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110 parallax-img"
                        />
                        <div
                            class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-500"
                        >
                        </div>
                    </div>
                    <div
                        class="absolute -top-10 -right-10 w-40 h-40 bg-gold-200/30 rounded-full blur-3xl -z-10"
                    >
                    </div>
                </div>
            </div>

            <!-- Peluquería (Image Left) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div class="relative group reveal-element opacity-0">
                    <div
                        class="overflow-hidden rounded-lg shadow-2xl relative h-[600px]"
                    >
                        <img
                            src={peluqueriaImg}
                            alt="Peluquería"
                            class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110 parallax-img"
                        />
                        <div
                            class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-500"
                        >
                        </div>
                    </div>
                    <div
                        class="absolute -bottom-10 -left-10 w-40 h-40 bg-gold-200/30 rounded-full blur-3xl -z-10"
                    >
                    </div>
                </div>
                <div class="space-y-8 reveal-text opacity-0">
                    <h2
                        class="text-4xl md:text-6xl font-serif font-bold text-brown-800"
                    >
                        Peluquería
                    </h2>
                    <p class="text-xl text-brown-600 leading-relaxed">
                        Salud capilar y estilo en perfecta armonía.
                        Especialistas en tratamientos de recuperación, alisados
                        y peinados para eventos.
                    </p>
                    <ul class="space-y-4 text-brown-700">
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Tratamientos de hidratación y botox
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Alisados orgánicos
                        </li>
                        <li class="flex items-center gap-3">
                            <span class="text-gold-500 text-xl">✦</span>
                            Peinados y ondas
                        </li>
                    </ul>
                    <div class="pt-4">
                        <a
                            href="/peluqueria"
                            class="inline-block bg-brown-800 text-cream-50 px-10 py-4 rounded-full hover:bg-gold-500 hover:text-brown-900 transition-all duration-300 font-medium"
                        >
                            Ver tratamientos de peluquería
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Quick Menu with Hover Reveal -->
    <section class="py-32 bg-white relative">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2
                class="text-4xl md:text-5xl font-serif font-bold text-center mb-16 text-brown-800 reveal-text opacity-0"
            >
                Menú rápido
            </h2>

            <!-- Floating Preview Card -->
            <div
                id="service-preview"
                class="fixed pointer-events-none z-50 opacity-0"
            >
                <div
                    class="bg-white rounded-lg shadow-2xl overflow-hidden border-2 border-gold-300 w-48 md:w-80"
                >
                    <img
                        id="preview-image"
                        src=""
                        alt=""
                        class="w-full h-48 object-cover"
                    />
                </div>
            </div>

            <div class="space-y-0">
                {
                    quickMenuServices.map((service) => (
                        <a
                            href={`/${service.category}/${service.slug}`}
                            class="service-list-item block border-b border-gold-200/30 py-6 cursor-pointer group transition-all duration-300 hover:bg-cream-50/50"
                            data-image={
                                service.hero_image_url || "/img/placeholder.svg"
                            }
                        >
                            <div class="flex items-center justify-between">
                                <h3 class="text-2xl md:text-3xl font-serif text-brown-800 group-hover:text-gold-600 transition-colors">
                                    {service.hero_title}
                                </h3>
                                <span class="text-brown-400 group-hover:text-gold-500 transition-colors text-xl">
                                    →
                                </span>
                            </div>
                        </a>
                    ))
                }
            </div>
        </div>
    </section>

    <Testimonials />

    <!-- Scripts -->
    <script>
        import { gsap } from "gsap";
        import { ScrollTrigger } from "gsap/ScrollTrigger";

        gsap.registerPlugin(ScrollTrigger);

        // Hero Animation
        gsap.to("#hero-image", {
            scale: 1.1,
            scrollTrigger: {
                trigger: "body",
                start: "top top",
                end: "bottom top",
                scrub: 1,
            },
        });

        // Reveal Text
        gsap.utils.toArray(".reveal-text").forEach((element: any) => {
            gsap.to(element, {
                opacity: 1,
                y: 0,
                duration: 1,
                ease: "power3.out",
                scrollTrigger: {
                    trigger: element,
                    start: "top 85%",
                },
            });
        });

        // Reveal Elements (Images)
        gsap.utils.toArray(".reveal-element").forEach((element: any) => {
            gsap.fromTo(
                element,
                { opacity: 0, y: 50 },
                {
                    opacity: 1,
                    y: 0,
                    duration: 1.2,
                    ease: "power3.out",
                    scrollTrigger: {
                        trigger: element,
                        start: "top 80%",
                    },
                },
            );
        });

        // Parallax Images in ZigZag
        gsap.utils.toArray(".parallax-img").forEach((img: any) => {
            gsap.to(img, {
                y: 50, // Subtle movement
                scrollTrigger: {
                    trigger: img.parentElement,
                    start: "top bottom",
                    end: "bottom top",
                    scrub: 1.5,
                },
            });
        });

        // Hover Reveal Logic (Same as Manicura)
        const preview = document.getElementById("service-preview");
        const previewImage = document.getElementById(
            "preview-image",
        ) as HTMLImageElement;
        const serviceItems = document.querySelectorAll(".service-list-item");

        let leftTo: any;
        let topTo: any;

        if (preview) {
            leftTo = gsap.quickTo(preview, "left", {
                duration: 0.6,
                ease: "power3.out",
            });
            topTo = gsap.quickTo(preview, "top", {
                duration: 0.6,
                ease: "power3.out",
            });
        }

        serviceItems.forEach((item) => {
            const element = item as HTMLElement;
            element.addEventListener("mouseenter", () => {
                const image = element.getAttribute("data-image");
                if (previewImage && preview) {
                    previewImage.src = image || "";
                    gsap.to(preview, { opacity: 1, duration: 0.3 });
                }
            });

            element.addEventListener("mousemove", (e: MouseEvent) => {
                if (preview && leftTo && topTo) {
                    const previewEl = preview.querySelector("div");
                    const previewHeight = previewEl
                        ? previewEl.offsetHeight
                        : 200;
                    const gap = 20;

                    // Smart Vertical Positioning
                    let targetY = e.clientY + gap;
                    if (e.clientY > window.innerHeight / 2) {
                        targetY = e.clientY - previewHeight - gap;
                    }

                    // Horizontal Positioning
                    const targetX = e.clientX + 40;

                    leftTo(targetX);
                    topTo(targetY);
                }
            });

            element.addEventListener("mouseleave", () => {
                if (preview) {
                    gsap.to(preview, { opacity: 0, duration: 0.3 });
                }
            });
        });
    </script>

    <style>
        .reveal-text {
            transform: translateY(30px);
        }
    </style>
</Layout>
<!-- DEBUG TIMESTAMP: {new Date().toISOString()} -->
